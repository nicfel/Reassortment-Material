clear

currdir = cd;

virus = {'h1n1pdm_sub1', 'h1n1pdm_sub2', 'h1n1pdm_sub3'...
        'h1n1sea_sub1', 'h1n1sea_sub2', 'h1n1sea_sub3'...
        'h3n2_sub1', 'h3n2_sub2', 'h3n2_sub3', ...
        'h3n2old', ...
        'h3n2recent', ...
        'h3n2new', ...
        'infB_sub1', 'infB_sub2', 'infB_sub3', ...
        'h2n2'};

workingdir = {'H1N1pandemic', 'H1N1pandemic', 'H1N1pandemic',...
        'H1N1seasonal',  'H1N1seasonal', 'H1N1seasonal',...
        'H3N2', 'H3N2', 'H3N2',...
        'H3N2', ...
        'H3N2', ...
        'H3N2', ...
        'InfB', 'InfB', 'InfB'...
        'H2N2'};

from = [2009, 2009, 2009,...
        1990, 1990, 1990,...
        1980, 1980, 1980,...
        1990, ...
        2005, ...
        2017, ...
        1980, 1980, 1980,...
        1920];
    
to =   [2019, 2019, 2019,...
        2010, 2010, 2010,...
        2020, 2020, 2020,...
        2005, ...
        2020, ...
        2020, ...
        2019, 2019, 2019,...
        1970];

temperature = [0.005, 0.005, 0.005,...
        0.005, 0.005, 0.005,...
        0.005, 0.005, 0.005,...
        0.005, ...
        0.005, ...
        0.005, ...
        0.005, 0.005, 0.005,...
        0.01];
    
temperature = temperature*2;
% delete all xmls in all working dirs
for i = 1 : length(workingdir)
    system(sprintf('rm -r %s/xmls', workingdir{i}));
    system(sprintf('mkdir %s/xmls', workingdir{i}));
end

% values for the random number generator that were at some point sampled at
% random from randi(1000000,12,1). This is done to be able to reproduce the
% exact subsampled datasets
rng_values = [171814,248584,744915,868949,146144,133529,337763,559988,653274,471007,787131,756643,522089,51096,921028,624097];


for i = 1 : length(virus)-1
    disp(virus{i})
    if i==12
        getXMLallsegmentsDummy(virus{i}, workingdir{i}, 200, from(i), to(i), temperature(i), rng_values(i), 2010);
        cd(currdir)
        getJointCoalallsegments(virus{i}, workingdir{i}, 200, from(i), to(i), temperature(i), rng_values(i), 2010);
        cd(currdir)
        getIndividualCoalallsegments(virus{i}, workingdir{i}, 200, from(i), to(i), temperature(i), rng_values(i), 2010);
    else
        getXMLallsegmentsDummy(virus{i}, workingdir{i}, 200, from(i), to(i), temperature(i), rng_values(i), 0);
    end
    cd(currdir)
end

% makes the xmls for H2N2 that also infer the tip heights
i=length(virus);
getXMLallsegments(virus{i}, workingdir{i}, 200, from(i), to(i), temperature(i), rng_values(i));
cd(currdir)